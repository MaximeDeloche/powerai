From f56ff7d07384ee4c433e3d5b852ece2c26f637c3 Mon Sep 17 00:00:00 2001
From: Nishidha Panpaliya <nishidha@us.ibm.com>
Date: Wed, 5 Feb 2020 08:32:55 +0000
Subject: [PATCH] Added a patch to fix boost compilation on ppc64le

---
 bazel/ray_deps_setup.bzl                           |  1 +
 .../patches/rules_boost-define-ppc64le.patch       | 50 ++++++++++++++++++++++
 2 files changed, 51 insertions(+)
 create mode 100644 thirdparty/patches/rules_boost-define-ppc64le.patch

diff --git a/bazel/ray_deps_setup.bzl b/bazel/ray_deps_setup.bzl
index e477009..d861594 100644
--- a/bazel/ray_deps_setup.bzl
+++ b/bazel/ray_deps_setup.bzl
@@ -129,6 +129,7 @@ def ray_deps_setup():
         patches = [
             "//thirdparty/patches:rules_boost-undefine-boost_fallthrough.patch",
             "//thirdparty/patches:rules_boost-windows-linkopts.patch",
+            "//thirdparty/patches:rules_boost-define-ppc64le.patch",
         ],
     )
 
diff --git a/thirdparty/patches/rules_boost-define-ppc64le.patch b/thirdparty/patches/rules_boost-define-ppc64le.patch
new file mode 100644
index 0000000..bdd2be6
--- /dev/null
+++ b/thirdparty/patches/rules_boost-define-ppc64le.patch
@@ -0,0 +1,39 @@
+diff --git BUILD.boost BUILD.boost
+--- BUILD.boost
++++ BUILD.boost
+@@ -49,7 +49,7 @@
+ )
+ 
+ config_setting(
+-    name = "linux_ppc",
++    name = "linux_ppc64le",
+     constraint_values = [
+         "@bazel_tools//platforms:linux",
+         "@bazel_tools//platforms:ppc",
+@@ -105,7 +105,7 @@
+         "libs/context/src/asm/make_arm_aapcs_elf_gas.S",
+         "libs/context/src/asm/ontop_arm_aapcs_elf_gas.S",
+     ],
+-    ":linux_ppc": [
++    ":linux_ppc64le": [
+         "libs/context/src/asm/jump_ppc64_sysv_elf_gas.S",
+         "libs/context/src/asm/make_ppc64_sysv_elf_gas.S",
+         "libs/context/src/asm/ontop_ppc64_sysv_elf_gas.S",
+@@ -163,7 +163,7 @@
+ BOOST_FIBER_NUMA_SRCS = select({
+     ":linux_arm": [
+     ],
+-    ":linux_ppc": [
++    ":linux_ppc64le": [
+         "libs/fiber/src/numa/linux/pin_thread.cpp",
+         "libs/fiber/src/numa/linux/topology.cpp",
+     ], # MAYBE SHOULD BE BLANK
+@@ -1728,7 +1728,7 @@
+     }),
+     defines = select({
+         ":linux_arm": [],
+-        ":linux_ppc": [],
++        ":linux_ppc64le": [],
+         ":linux_x86_64": [],
+         ":osx_x86_64": [],
+         ":windows_x86_64": [
-- 
1.8.3.1

