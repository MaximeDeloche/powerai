From 689e9e36dfc0a5ef75c694a34ec4ab75e2cd8733 Mon Sep 17 00:00:00 2001
From: Nishidha Panpaliya <nishidha@us.ibm.com>
Date: Tue, 4 Feb 2020 07:37:58 +0000
Subject: [PATCH] Build changes for conda

---
 BUILD.bazel | 2 +-
 build.sh    | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/BUILD.bazel b/BUILD.bazel
index df47cf0..276b8a5 100644
--- a/BUILD.bazel
+++ b/BUILD.bazel
@@ -1482,7 +1482,7 @@
             tmpdir="redis.tmp" &&
             path=$(location @com_github_antirez_redis//:file) &&
             cp -p -L -R -- "$${path%/*}" "$${tmpdir}" &&
-            make -s -C "$${tmpdir}" -j"$$(getconf _NPROCESSORS_ONLN || echo 1)" &&
+            make CC=$$CONDACC -s -C "$${tmpdir}" -j"$$(getconf _NPROCESSORS_ONLN || echo 1)" &&
             mv "$${tmpdir}"/src/redis-server $(location redis-server) &&
             chmod +x $(location redis-server) &&
             mv "$${tmpdir}"/src/redis-cli $(location redis-cli) &&
diff --git a/build.sh b/build.sh
index 97c16b2..07d80da 100755
--- a/build.sh
+++ b/build.sh
@@ -150,7 +150,8 @@
 fi
 
 if [ "$RAY_BUILD_PYTHON" == "YES" ]; then
-  "$BAZEL_EXECUTABLE" build //:ray_pkg --verbose_failures
+  "$BAZEL_EXECUTABLE" --host_jvm_args=-Xms512m --host_jvm_args=-Xmx3072m build --jobs=10 //:ray_pkg --action_env=CONDACC=$CC --verbose_failures
+
 fi
 
 popd
-- 
1.8.3.1

